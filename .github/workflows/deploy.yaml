name: Deploy

on:
  push:
    branches:
      - main
      - prod
    tags:
      - 'v*'

jobs:
  deployment:
    runs-on: ubuntu-latest
    environment: ${{ startsWith(github.ref, 'refs/tags/') && 'main' || github.ref_name }}
    steps:
      - name: Trigger deploy
        run: |
          curl --fail-with-body --silent --show-error -X POST "${{ secrets.HOOKURL }}?commit=${{ github.sha }}" -H "X-Key: ${{ secrets.HOOKSECRET }}"
